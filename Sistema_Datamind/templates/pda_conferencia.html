<!-- <!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Conferência de Romaneio</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }

    .header {
      background: #ffffff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .header h2 {
      margin-top: 0;
    }

    .info {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 10px;
    }

    .info div {
      flex: 1;
      min-width: 200px;
    }

    .info strong {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .volume-section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    label {
      font-weight: bold;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 18px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
  </style>
</head>
<body>

  <div class="header">
    <h2>Romaneio em Andamento</h2>
    <div class="info">
      <div><strong>ID:</strong> {{ romaneio_id }}</div>
      <div><strong>Conferente:</strong> {{ conferente }}</div>
      <div><strong>Motorista:</strong> {{ motorista }}</div>
      <div><strong>Filial:</strong> {{ filial }}</div>
      <div><strong>Placa:</strong> {{ placa }}</div>
      <div><strong>Início:</strong> {{ data_inicio }}</div>
    </div>
  </div>

  <div class="volume-section">
    <label for="volume">Leia o Código do Volume:</label>
    <input type="text" id="volume" name="volume" autofocus placeholder="Ex: 524047-7/13">
    <p><small>Dica: Colete aqui os volumes conforme forem sendo lidos.</small></p>
  </div>
  
</body>
</html> -->

<!-- 

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Conferência de Romaneio</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 10px;
      font-size: 14px;
    }

    .header {
      background: #ffffff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-bottom: 15px;
    }

    .header h2 {
      margin-top: 0;
      font-size: 16px;
      font-weight: bold;
    }

    .info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .info div {
      font-size: 13px;
    }

    .info strong {
      font-weight: bold;
    }

    .volume-section {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    small {
      display: block;
      margin-top: 8px;
      color: #666;
    }
  </style>
</head>
<body>

  <div class="header">
    <h2>Romaneio em Andamento</h2>
    <div class="info">
      <div><strong>ID:</strong> {{ romaneio_id }}</div>
      <div><strong>Placa:</strong> {{ placa }}</div>
      <div><strong>Motorista:</strong> {{ motorista }}</div>
      <div><strong>Início:</strong> {{ data_inicio }}</div>
      <div><strong>Conferente:</strong> {{ conferente }}</div>
      <div><strong>Filial:</strong> {{ filial }}</div>
    </div>
  </div>

  <div class="volume-section">
    <label for="volume">Leia o Código do Volume:</label>
    <input type="text" id="volume" name="volume" autofocus placeholder="Ex: 524047-7/13">
    <p><small>Dica: Colete aqui os volumes conforme forem sendo lidos.</small></p>
  </div>
  
</body>
</html> -->








<!-- 

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Conferência de Romaneio</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 10px;
      font-size: 14px;
    }

    .header {
      background: #ffffff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-bottom: 15px;
    }

    .header h2 {
      margin-top: 0;
      font-size: 16px;
      font-weight: bold;
    }

    .info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .info div {
      font-size: 13px;
    }

    .info strong {
      font-weight: bold;
    }

    .volume-section {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    small {
      display: block;
      margin-top: 8px;
      color: #666;
    }

    ul#lista-volumes li {
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }

    button.finalizar {
      margin-top: 20px;
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }

    button.finalizar:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>

  <div class="header">
    <h2>Romaneio em Andamento</h2>
    <div class="info">
      <div><strong>ID:</strong> {{ romaneio_id }}</div>
      <div><strong>Placa:</strong> {{ placa }}</div>
      <div><strong>Motorista:</strong> {{ motorista }}</div>
      <div><strong>Início:</strong> {{ data_inicio }}</div>
      <div><strong>Conferente:</strong> {{ conferente }}</div>
      <div><strong>Filial:</strong> {{ filial }}</div>
    </div>
  </div>

  <div class="volume-section">
    <label for="volume">Leia o Código do Volume:</label>
    <input type="text" id="volume" name="volume" autofocus placeholder="Ex: 524047-7/13">
    <p><small>Dica: Colete aqui os volumes conforme forem sendo lidos.</small></p>
    <ul id="lista-volumes"></ul>
  </div>

  <form action="{{ url_for('finalizar_romaneio', romaneio_id=romaneio_id) }}" method="post">
    <button type="submit" class="finalizar">Finalizar Romaneio</button>
  </form>

  <script>
    document.getElementById('volume').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault(); // Evita comportamento padrão
        const codigo = this.value.trim();
        if (!codigo) return;

        fetch('/registrar_volume', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: 'romaneio_id={{ romaneio_id }}&codigo_volume=' + encodeURIComponent(codigo)
        })
        .then(response => response.json())
        .then(data => {
          if (data.status === 'ok') {
            const li = document.createElement('li');
            li.textContent = '✅ ' + codigo;
            document.getElementById('lista-volumes').appendChild(li);
            document.getElementById('volume').value = '';
          } else {
            alert('Erro ao registrar volume: ' + (data.msg || 'Tente novamente'));
          }
        })
        .catch(err => {
          console.error(err);
          alert('Falha na conexão com o servidor.');
        });
      }
    });
  </script>

</body>
</html> -->
<!-- 

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Conferência de Romaneio</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 10px;
      font-size: 14px;
    }

    .header {
      background: #ffffff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-bottom: 15px;
    }

    .header h2 {
      margin-top: 0;
      font-size: 16px;
      font-weight: bold;
    }

    .info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .info div {
      font-size: 13px;
    }

    .info strong {
      font-weight: bold;
    }

    .volume-section {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    small {
      display: block;
      margin-top: 8px;
      color: #666;
    }

    ul#lista-volumes li {
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }

    .mensagem {
      display: none;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
      font-size: 14px;
    }

    .mensagem.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .mensagem.warning {
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
    }

    .mensagem.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    button.finalizar {
      margin-top: 20px;
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }

    button.finalizar:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>

  <div class="header">
    <h2>Romaneio em Andamento</h2>
    <div class="info">
      <div><strong>ID:</strong> {{ romaneio_id }}</div>
      <div><strong>Placa:</strong> {{ placa }}</div>
      <div><strong>Motorista:</strong> {{ motorista }}</div>
      <div><strong>Início:</strong> {{ data_inicio }}</div>
      <div><strong>Conferente:</strong> {{ conferente }}</div>
      <div><strong>Filial:</strong> {{ filial }}</div>
    </div>
  </div>

  <div class="volume-section">
    <label for="volume">Leia o Código do Volume:</label>
    <input type="text" id="volume" name="volume" autofocus placeholder="Ex: 524047-7/13">
    <p><small>Dica: Colete aqui os volumes conforme forem sendo lidos.</small></p>
    <div id="mensagem" class="mensagem"></div>
    <ul id="lista-volumes"></ul>
  </div>

  <form action="{{ url_for('finalizar_romaneio', romaneio_id=romaneio_id) }}" method="post">
    <button type="submit" class="finalizar">Finalizar Romaneio</button>
  </form>

  <script>
    document.getElementById('volume').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault(); // Evita comportamento padrão
        const codigo = this.value.trim();
        if (!codigo) return;

        fetch('/registrar_volume', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams({
            romaneio_id: '{{ romaneio_id }}',
            codigo_volume: codigo
          })
        })
        .then(response => response.json())
        .then(data => {
          const msgDiv = document.getElementById('mensagem');
          msgDiv.style.display = 'block';

          if (data.status === 'ok') {
            const li = document.createElement('li');
            li.textContent = '✅ ' + codigo;
            document.getElementById('lista-volumes').appendChild(li);
            document.getElementById('volume').value = '';
            msgDiv.className = 'mensagem success';
            msgDiv.textContent = data.msg || 'Volume adicionado com sucesso!';
          } else if (data.status === 'warning') {
            msgDiv.className = 'mensagem warning';
            msgDiv.textContent = data.msg;
          } else {
            msgDiv.className = 'mensagem error';
            msgDiv.textContent = data.msg || 'Erro ao registrar volume.';
          }
        })
        .catch(err => {
          console.error(err);
          const msgDiv = document.getElementById('mensagem');
          msgDiv.style.display = 'block';
          msgDiv.className = 'mensagem error';
          msgDiv.textContent = 'Falha na conexão com o servidor.';
        });
      }
    });
  </script>

</body>
</html> -->



<!-- 
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Conferência de Romaneio</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 10px;
      font-size: 14px;
    }

    .header {
      background: #ffffff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-bottom: 15px;
    }

    .header h2 {
      margin-top: 0;
      font-size: 16px;
      font-weight: bold;
    }

    .info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .info div {
      font-size: 13px;
    }

    .info strong {
      font-weight: bold;
    }

    .volume-section {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    small {
      display: block;
      margin-top: 8px;
      color: #666;
    }

    ul#lista-volumes li {
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }

    .mensagem {
      display: none;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
      font-size: 14px;
    }

    .mensagem.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .mensagem.warning {
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
    }

    .mensagem.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    button.finalizar {
      margin-top: 20px;
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }

    button.finalizar:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>

  <div class="header">
    <h2>Romaneio em Andamento</h2>
    <div class="info">
      <div><strong>ID:</strong> {{ romaneio_id }}</div>
      <div><strong>Placa:</strong> {{ placa }}</div>
      <div><strong>Motorista:</strong> {{ motorista }}</div>
      <div><strong>Início:</strong> {{ data_inicio }}</div>
      <div><strong>Conferente:</strong> {{ conferente }}</div>
      <div><strong>Filial:</strong> {{ filial }}</div>
    </div>
  </div>

  <div class="volume-section">
    <label for="volume">Leia o Código do Volume:</label>
    <input type="text" id="volume" name="volume" autofocus placeholder="Ex: 524047-7/13">
    <p><small>Dica: Colete aqui os volumes conforme forem sendo lidos.</small></p>
    <div id="mensagem" class="mensagem"></div>
    <ul id="lista-volumes"></ul>
  </div>

  <form action="{{ url_for('finalizar_romaneio', romaneio_id=romaneio_id) }}" method="post">
    <button type="submit" class="finalizar">Finalizar Romaneio</button>
  </form>

  <script>
    document.getElementById('volume').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault(); // Evita comportamento padrão
        const codigo = this.value.trim();
        if (!codigo) return;

        const msgDiv = document.getElementById('mensagem');
        msgDiv.style.display = 'block';
        msgDiv.className = 'mensagem'; // Reseta classe

        fetch('/registrar_volume', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams({
            romaneio_id: '{{ romaneio_id }}',
            codigo_volume: codigo
          })
        })
        .then(response => response.json())
        .then(data => {

          if (data.status === 'ok') {
            const li = document.createElement('li');
            li.textContent = '✅ ' + codigo;
            document.getElementById('lista-volumes').appendChild(li);
            this.value = '';
            msgDiv.className = 'mensagem success';
            msgDiv.textContent = data.msg || 'Volume adicionado com sucesso!';
          } else if (data.status === 'warning') {
            msgDiv.className = 'mensagem warning';
            msgDiv.textContent = data.msg;
          } else {
            msgDiv.className = 'mensagem error';
            msgDiv.textContent = data.msg || 'Erro ao registrar volume.';
          }

        })
        .catch(err => {
          console.error(err);
          msgDiv.style.display = 'block';
          msgDiv.className = 'mensagem error';
          msgDiv.textContent = 'Falha na conexão com o servidor.';
        });
      }
    });
  </script>

</body>
</html> -->




<!-- 



<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Conferência de Romaneio</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"  rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 10px;
    }

    .header {
      background: #ffffff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-bottom: 15px;
    }

    .info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .info div {
      font-size: 13px;
    }

    .volume-section {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    small {
      display: block;
      margin-top: 8px;
      color: #666;
    }

    ul#lista-volumes li {
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }

    .mensagem {
      display: none;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
      font-size: 14px;
    }

    .mensagem.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .mensagem.warning {
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
    }

    .mensagem.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    button.finalizar {
      margin-top: 20px;
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }

    button.finalizar:hover {
      background-color: #0056b3;
    }

    /* Estilo para o modal */
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      z-index: 9999;
    }
  </style>
</head>
<body>

  <div class="header">
    <h2>Romaneio em Andamento</h2>
    <div class="info">
      <div><strong>ID:</strong> {{ romaneio_id }}</div>
      <div><strong>Placa:</strong> {{ placa }}</div>
      <div><strong>Motorista:</strong> {{ motorista }}</div>
      <div><strong>Início:</strong> {{ data_inicio }}</div>
      <div><strong>Conferente:</strong> {{ conferente }}</div>
      <div><strong>Filial:</strong> {{ filial }}</div>
    </div>
  </div>

  <div class="volume-section">
    <label for="volume">Leia o Código do Volume:</label>
    <input type="text" id="volume" name="volume" autofocus placeholder="Ex: 524047-7/13">
    <p><small>Dica: Colete aqui os volumes conforme forem sendo lidos.</small></p>
    <div id="mensagem" class="mensagem"></div>
    <ul id="lista-volumes"></ul>
  </div>

  !-- Lista de pedidos --
  <div class="pedido-section">
    <h3>Pedidos em Conferência</h3>
    <ul id="lista-pedidos"></ul>
  </div>

  !-- Botão Finalizar --
  <form action="{{ url_for('finalizar_romaneio', romaneio_id=romaneio_id) }}" method="post">
    <button type="submit" class="finalizar">Finalizar Romaneio</button>
  </form>

  <-- Modal para exibir detalhes do pedido --
  <div id="modal-pedido" class="modal" style="display: none;">
    <h4 id="modal-titulo"></h4>
    <p id="modal-descricao"></p>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Código de Barras</th>
          <th>Data de Conferência</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="modal-corpo"></tbody>
    </table>
    <button onclick="fecharModal()">Fechar</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> 
  <script>
    // Carregar pedidos ao carregar a página
    fetch('/get_pedidos/{{ romaneio_id }}')
      .then(response => response.json())
      .then(data => {
        if (data.status === 'ok') {
          const pedidos = data.pedidos;
          const listaPedidos = document.getElementById('lista-pedidos');
          pedidos.forEach(pedido => {
            const li = document.createElement('li');
            li.innerHTML = `
              ${pedido.status === 'ok' ? '<span class="badge bg-success">✅</span>' : '<span class="badge bg-danger">❌</span>'}
              Pedido: ${pedido.numero_pedido} (${pedido.volumes_escaneados}/${pedido.total_volumes})
              <button onclick="abrirModal(${pedido.pedido_id})">Ver Volumes</button>
            `;
            listaPedidos.appendChild(li);
          });
        }
      });

    // Função para abrir o modal
    function abrirModal(pedidoId) {
      fetch(`/get_volumes/${pedidoId}`)
        .then(response => response.json())
        .then(data => {
          if (data.status === 'ok') {
            const modal = document.getElementById('modal-pedido');
            modal.style.display = 'block';

            const titulo = document.getElementById('modal-titulo');
            const descricao = document.getElementById('modal-descricao');
            const corpo = document.getElementById('modal-corpo');

            titulo.textContent = `Detalhes do Pedido ${data.pedido.numero_pedido}`;
            descricao.textContent = `Total de Volumes: ${data.pedido.total_volumes}`;

            corpo.innerHTML = '';
            data.volumes.forEach(volume => {
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td>${volume.codigo_barra}</td>
                <td>${volume.data_conferencia}</td>
                <td>${volume.status}</td>
              `;
              corpo.appendChild(tr);
            });
          }
        });
    }

    // Função para fechar o modal
    function fecharModal() {
      document.getElementById('modal-pedido').style.display = 'none';
    }

    // Lógica para escanear volumes
    document.getElementById('volume').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        const codigo = this.value.trim();
        if (!codigo) return;

        fetch('/registrar_volume', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams({
            romaneio_id: '{{ romaneio_id }}',
            codigo_volume: codigo
          })
        })
        .then(response => response.json())
        .then(data => {
          const msgDiv = document.getElementById('mensagem');
          msgDiv.style.display = 'block';

          if (data.status === 'ok') {
            const li = document.createElement('li');
            li.textContent = '✅ ' + codigo;
            document.getElementById('lista-volumes').appendChild(li);
            this.value = '';
            msgDiv.className = 'mensagem success';
            msgDiv.textContent = data.msg || 'Volume adicionado com sucesso!';
          } else if (data.status === 'warning') {
            msgDiv.className = 'mensagem warning';
            msgDiv.textContent = data.msg;
          } else {
            msgDiv.className = 'mensagem error';
            msgDiv.textContent = data.msg || 'Erro ao registrar volume.';
          }
        })
        .catch(err => {
          console.error(err);
          const msgDiv = document.getElementById('mensagem');
          msgDiv.style.display = 'block';
          msgDiv.className = 'mensagem error';
          msgDiv.textContent = 'Falha na conexão com o servidor.';
        });
      }
    });
  </script>

</body>
</html> -->








<!-- 

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Conferência de Romaneio</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"  rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 10px;
    }

    .header {
      background: #ffffff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-bottom: 15px;
    }

    .info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .info div {
      font-size: 13px;
    }

    .volume-section {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    small {
      display: block;
      margin-top: 8px;
      color: #666;
    }

    ul#lista-volumes li {
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }

    .mensagem {
      display: none;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
      font-size: 14px;
    }

    .mensagem.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .mensagem.warning {
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
    }

    .mensagem.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    button.finalizar {
      margin-top: 20px;
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }

    button.finalizar:hover {
      background-color: #0056b3;
    }

    /* Estilo para o modal */
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      z-index: 9999;
    }
  </style>
</head>
<body>

  <div class="header">
    <h2>Romaneio em Andamento</h2>
    <div class="info">
      <div><strong>ID:</strong> {{ romaneio_id }}</div>
      <div><strong>Placa:</strong> {{ placa }}</div>
      <div><strong>Motorista:</strong> {{ motorista }}</div>
      <div><strong>Início:</strong> {{ data_inicio }}</div>
      <div><strong>Conferente:</strong> {{ conferente }}</div>
      <div><strong>Filial:</strong> {{ filial }}</div>
    </div>
  </div>

  <div class="volume-section">
    <label for="volume">Leia o Código do Volume:</label>
    <input type="text" id="volume" name="volume" autofocus placeholder="Ex: 524047-7/13">
    <p><small>Dica: Colete aqui os volumes conforme forem sendo lidos.</small></p>
    <div id="mensagem" class="mensagem"></div>
    <ul id="lista-volumes"></ul>
  </div>

  !-- Lista de pedidos --
  <div class="pedido-section">
    <h3>Pedidos em Conferência</h3>
    <ul id="lista-pedidos"></ul>
  </div>

  !-- Botão Finalizar --
  <form action="{{ url_for('finalizar_romaneio', romaneio_id=romaneio_id) }}" method="post">
    <button type="submit" class="finalizar">Finalizar Romaneio</button>
  </form>

  !-- Modal para exibir detalhes do pedido --
  <div id="modal-pedido" class="modal" style="display: none;">
    <h4 id="modal-titulo"></h4>
    <p id="modal-descricao"></p>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Código de Barras</th>
          <th>Data de Conferência</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="modal-corpo"></tbody>
    </table>
    <button onclick="fecharModal()">Fechar</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> 
  <script>
    // Carregar pedidos ao carregar a página
    fetch('/get_pedidos/{{ romaneio_id }}')
      .then(response => response.json())
      .then(data => {
        if (data.status === 'ok') {
          const pedidos = data.pedidos;
          const listaPedidos = document.getElementById('lista-pedidos');
          pedidos.forEach(pedido => {
            const li = document.createElement('li');
            li.innerHTML = `
              ${pedido.status === 'ok' ? '<span class="badge bg-success">✅</span>' : '<span class="badge bg-danger">❌</span>'}
              Pedido: ${pedido.numero_pedido} (${pedido.volumes_escaneados}/${pedido.total_volumes})
              <button onclick="abrirModal(${pedido.pedido_id})">Ver Volumes</button>
            `;
            listaPedidos.appendChild(li);
          });
        }
      });

    // Função para abrir o modal
    function abrirModal(pedidoId) {
      fetch(`/get_volumes/${pedidoId}`)
        .then(response => response.json())
        .then(data => {
          if (data.status === 'ok') {
            const modal = document.getElementById('modal-pedido');
            modal.style.display = 'block';

            const titulo = document.getElementById('modal-titulo');
            const descricao = document.getElementById('modal-descricao');
            const corpo = document.getElementById('modal-corpo');

            titulo.textContent = `Detalhes do Pedido ${data.pedido.numero_pedido}`;
            descricao.textContent = `Total de Volumes: ${data.pedido.total_volumes}`;

            corpo.innerHTML = '';
            data.volumes.forEach(volume => {
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td>${volume.codigo_barra}</td>
                <td>${volume.data_conferencia}</td>
                <td>${volume.status}</td>
              `;
              corpo.appendChild(tr);
            });
          }
        });
    }

    // Função para fechar o modal
    function fecharModal() {
      document.getElementById('modal-pedido').style.display = 'none';
    }

    // Lógica para escanear volumes
    document.getElementById('volume').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        const codigo = this.value.trim();
        if (!codigo) return;

        fetch('/registrar_volume', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams({
            romaneio_id: '{{ romaneio_id }}',
            codigo_volume: codigo
          })
        })
        .then(response => response.json())
        .then(data => {
          const msgDiv = document.getElementById('mensagem');
          msgDiv.style.display = 'block';

          if (data.status === 'ok') {
            const li = document.createElement('li');
            li.textContent = '✅ ' + codigo;
            document.getElementById('lista-volumes').appendChild(li);
            this.value = '';
            msgDiv.className = 'mensagem success';
            msgDiv.textContent = data.msg || 'Volume adicionado com sucesso!';
          } else if (data.status === 'warning') {
            msgDiv.className = 'mensagem warning';
            msgDiv.textContent = data.msg;
          } else {
            msgDiv.className = 'mensagem error';
            msgDiv.textContent = data.msg || 'Erro ao registrar volume.';
          }
        })
        .catch(err => {
          console.error(err);
          const msgDiv = document.getElementById('mensagem');
          msgDiv.style.display = 'block';
          msgDiv.className = 'mensagem error';
          msgDiv.textContent = 'Falha na conexão com o servidor.';
        });
      }
    });
  </script>

</body>
</html> -->







<!-- 

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Conferência de Romaneio</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 10px;
      font-size: 14px;
    }

    .header {
      background: #ffffff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-bottom: 15px;
    }

    .header h2 {
      margin-top: 0;
      font-size: 16px;
      font-weight: bold;
    }

    .info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .info div {
      font-size: 13px;
    }

    .info strong {
      font-weight: bold;
    }

    .volume-section {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    small {
      display: block;
      margin-top: 8px;
      color: #666;
    }

    ul#lista-volumes li {
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }

    .mensagem {
      display: none;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
      font-size: 14px;
    }

    .mensagem.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .mensagem.warning {
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
    }

    .mensagem.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .pedido-section {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-top: 20px;
    }

    .pedido-section h3 {
      margin-top: 0;
      font-size: 16px;
      margin-bottom: 10px;
    }

    ul#lista-pedidos {
      list-style: none;
      padding-left: 0;
    }

    ul#lista-pedidos li {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .badge {
      font-size: 16px;
      margin-right: 10px;
    }

    button.finalizar {
      margin-top: 20px;
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }

    button.finalizar:hover {
      background-color: #0056b3;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      z-index: 9999;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      max-width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      display: none;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.5);
      z-index: 9998;
    }
  </style>
</head>
<body>

  !-- Cabeçalho --
  <div class="header">
    <h2>Romaneio em Andamento</h2>
    <div class="info">
      <div><strong>ID:</strong> {{ romaneio_id }}</div>
      <div><strong>Placa:</strong> {{ placa }}</div>
      <div><strong>Motorista:</strong> {{ motorista }}</div>
      <div><strong>Início:</strong> {{ data_inicio }}</div>
      <div><strong>Conferente:</strong> {{ conferente }}</div>
      <div><strong>Filial:</strong> {{ filial }}</div>
    </div>
  </div>

  !-- Leitura de Volume --
  <div class="volume-section">
    <label for="volume">Leia o Código do Volume:</label>
    <input type="text" id="volume" name="volume" autofocus placeholder="Ex: 524047-7/13">
    <p><small>Dica: Colete aqui os volumes conforme forem sendo lidos.</small></p>
    <div id="mensagem" class="mensagem"></div>
    <ul id="lista-volumes"></ul>
  </div>

  !-- Seção de Pedidos --
  <div class="pedido-section">
    <h3>Pedidos em Conferência</h3>
    <ul id="lista-pedidos"></ul>
  </div>

  !-- Botão Finalizar --
  <form action="{{ url_for('finalizar_romaneio', romaneio_id=romaneio_id) }}" method="post">
    <button type="submit" class="finalizar">Finalizar Romaneio</button>
  </form>

  !-- Modal para exibir detalhes do pedido --
  <div class="overlay" id="modal-overlay"></div>
  <div class="modal" id="modal-pedido">
    <h4 id="modal-titulo"></h4>
    <table id="modal-corpo" style="width:100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th style="border: 1px solid #ccc; padding: 8px;">Código de Barras</th>
          <th style="border: 1px solid #ccc; padding: 8px;">Data</th>
          <th style="border: 1px solid #ccc; padding: 8px;">Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="fecharModal()" style="margin-top: 10px;">Fechar</button>
  </div>

  <script>
    // Carregar pedidos ao carregar a página
    window.onload = () => {
      const romaneio_id = "{{ romaneio_id }}";

      fetch(`/get_pedidos/${romaneio_id}`)
        .then(response => response.json())
        .then(data => {
          if (data.status === 'ok') {
            const pedidos = data.pedidos;
            const listaPedidos = document.getElementById('lista-pedidos');
            pedidos.forEach(pedido => {
              const li = document.createElement('li');
              li.innerHTML = `
                ${pedido.status === 'ok' ? '<span class="badge" style="color:white;background:green;">✅</span>' : '<span class="badge" style="color:white;background:red;">❌</span>'}
                Pedido: ${pedido.numero_pedido} (${pedido.volumes_escaneados}/${pedido.total_volumes})
                <button onclick="abrirModal(${pedido.pedido_id})">Ver Volumes</button>
              `;
              listaPedidos.appendChild(li);
            });
          } else {
            console.error("Erro ao carregar pedidos:", data.msg);
          }
        })
        .catch(err => {
          console.error("Erro na requisição:", err);
        });

      // Escuta do campo de volume
      document.getElementById('volume').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          const codigo = this.value.trim();
          if (!codigo) return;

          fetch('/registrar_volume', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({
              romaneio_id: '{{ romaneio_id }}',
              codigo_volume: codigo
            })
          })
          .then(response => response.json())
          .then(data => {
            const msgDiv = document.getElementById('mensagem');
            msgDiv.style.display = 'block';

            if (data.status === 'ok') {
              const li = document.createElement('li');
              li.textContent = '✅ ' + data.volume;
              document.getElementById('lista-volumes').appendChild(li);
              this.value = '';
              msgDiv.className = 'mensagem success';
              msgDiv.textContent = data.msg || 'Volume adicionado com sucesso!';
              location.reload(); // Atualiza a lista de pedidos após novo volume
            } else if (data.status === 'warning') {
              msgDiv.className = 'mensagem warning';
              msgDiv.textContent = data.msg;
            } else {
              msgDiv.className = 'mensagem error';
              msgDiv.textContent = data.msg || 'Erro ao registrar volume.';
            }
          })
          .catch(err => {
            console.error(err);
            const msgDiv = document.getElementById('mensagem');
            msgDiv.style.display = 'block';
            msgDiv.className = 'mensagem error';
            msgDiv.textContent = 'Falha na conexão com o servidor.';
          });
        }
      });
    };

    // Abrir modal com volumes do pedido
    function abrirModal(pedido_id) {
      fetch(`/get_volumes/${pedido_id}`)
        .then(response => response.json())
        .then(data => {
          if (data.status === 'ok') {
            const modal = document.getElementById('modal-pedido');
            const overlay = document.getElementById('modal-overlay');
            const titulo = document.querySelector('#modal-titulo');
            const corpo = document.querySelector('#modal-corpo tbody');

            titulo.textContent = `Volumes do Pedido ${data.pedido.numero_pedido}`;
            corpo.innerHTML = '';

            data.volumes.forEach(volume => {
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td style="border: 1px solid #ccc; padding: 6px;">${volume.codigo_barra}</td>
                <td style="border: 1px solid #ccc; padding: 6px;">${volume.data_conferencia}</td>
                <td style="border: 1px solid #ccc; padding: 6px;">${volume.status}</td>
              `;
              corpo.appendChild(tr);
            });

            modal.style.display = 'block';
            overlay.style.display = 'block';
          }
        });
    }

    // Fechar modal
    function fecharModal() {
      document.getElementById('modal-pedido').style.display = 'none';
      document.getElementById('modal-overlay').style.display = 'none';
    }
  </script>

</body>
</html> -->







<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Conferência de Romaneio</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 10px;
      font-size: 14px;
    }

    .header {
      background: #ffffff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-bottom: 15px;
    }

    .header h2 {
      margin-top: 0;
      font-size: 16px;
      font-weight: bold;
    }

    .info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .info div {
      font-size: 13px;
    }

    .info strong {
      font-weight: bold;
    }

    .volume-section {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    small {
      display: block;
      margin-top: 8px;
      color: #666;
    }

    ul#lista-volumes li,
    ul#lista-pedidos li {
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }

    .mensagem {
      display: none;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
      font-size: 14px;
    }

    .mensagem.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .mensagem.warning {
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
    }

    .mensagem.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .pedido-section {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-top: 20px;
    }

    .pedido-section h3 {
      margin-top: 0;
      font-size: 16px;
      margin-bottom: 10px;
    }

    ul#lista-pedidos {
      list-style: none;
      padding-left: 0;
    }

    ul#lista-pedidos li {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .badge {
      font-size: 16px;
      margin-right: 10px;
    }

    button.finalizar {
      margin-top: 20px;
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }

    button.finalizar:hover {
      background-color: #0056b3;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      z-index: 9999;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      max-width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      display: none;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.5);
      z-index: 9998;
    }

    table#modal-corpo {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    table#modal-corpo th,
    table#modal-corpo td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
    }

    .badge {
  font-size: 16px;
  margin-right: 10px;
}

.badge.bg-success {
  color: white;
  background-color: green;
}

.badge.bg-danger {
  color: rgb(255, 0, 0);
  background-color: rgb(255, 255, 255);
}
.swipe-container {
  position: relative;
  overflow: hidden;
  background-color: #fff;
  border-bottom: 1px solid #eee;
  padding: 8px 0;
}

.swipe-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: transform 0.3s ease;
}

.swipe-delete-btn {
  position: absolute;
  right: -80px;
  top: 50%;
  transform: translateY(-50%);
  width: 70px;
  height: 30px;
  background-color: red;
  color: white;
  font-size: 14px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: right 0.3s ease;
}

.swipe-container.swiped .swipe-delete-btn {
  right: 10px;
}

.swipe-container.swiped .swipe-content {
  transform: translateX(-80px);
}
.swipe-container {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color: #fff;
  border-bottom: 1px solid #eee;
  padding: 8px;
  margin-bottom: 8px;
}

.swipe-content {
  display: flex;
  align-items: center;
  transition: transform 0.3s ease;
  flex: 1;
}

.swipe-delete-btn {
  position: absolute;
  right: -80px;
  top: 50%;
  transform: translateY(-50%);
  width: 70px;
  height: 30px;
  background-color: red;
  color: white;
  font-size: 12px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: right 0.3s ease;
  z-index: 10;
}

.swipe-container.swiped .swipe-delete-btn {
  right: 10px;
}

.swipe-container .swipe-view-btn {
  position: static;
  width: auto;
  height: auto;
  background: transparent;
  color: #007bff;
  border: none;
  font-weight: bold;
  font-size: 14px;
  margin-left: 10px;
  z-index: 1;
}
  </style>
</head>
<body>

  <!-- Cabeçalho -->
  <div class="header">
    <h2>Romaneio em Andamento</h2>
    <div class="info">
      <div><strong>ID:</strong> {{ romaneio_id }}</div>
      <div><strong>Placa:</strong> {{ placa }}</div>
      <div><strong>Motorista:</strong> {{ motorista }}</div>
      <div><strong>Início:</strong> {{ data_inicio }}</div>
      <div><strong>Conferente:</strong> {{ conferente }}</div>
      <div><strong>Filial:</strong> {{ filial }}</div>
    </div>
  </div>

  <!-- Campo de leitura de volume -->
  <div class="volume-section">
    <label for="volume">Leia o Código do Volume:</label>
    <input type="text" id="volume" name="volume" autofocus placeholder="Ex: 524047-7/13" />
    <p><small>Dica: Colete aqui os volumes conforme forem sendo lidos.</small></p>
    <div id="mensagem" class="mensagem"></div>
    <ul id="lista-volumes"></ul>
  </div>

  <!-- Lista de Pedidos -->
  <div class="pedido-section">
    <h3>Pedidos em Conferência</h3>
    <ul id="lista-pedidos"></ul>
  </div>

  <!-- Botão Finalizar -->
  <form action="{{ url_for('finalizar_romaneio', romaneio_id=romaneio_id) }}" method="post">
    <button type="submit" class="finalizar">Finalizar Romaneio</button>
  </form>

  <!-- Modal para exibir detalhes do pedido -->
  <div class="overlay" id="modal-overlay"></div>
  <div class="modal" id="modal-pedido">
    <h4 id="modal-titulo">Volumes do Pedido</h4>
    <table id="modal-corpo">
      <thead>
        <tr>
          <th>Nº Pedido</th>
          <th>Data</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="fecharModal()" style="margin-top: 10px;">Fechar</button>
  </div>

  <script>
    // Carregar volumes e pedidos ao carregar a página
    window.onload = () => {
  const romaneio_id = "{{ romaneio_id }}";

  // Carrega os pedidos com swipe e botão de exclusão
  carregarPedidos(); 

  // Foca automaticamente no campo de escaneamento
  document.getElementById('volume').focus();

  // Escuta escaneamento de volumes
  document.getElementById('volume').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      const codigo = this.value.trim();
      if (!codigo) return;

      fetch('/registrar_volume', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams({
          romaneio_id: '{{ romaneio_id }}',
          codigo_volume: codigo
        })
      })
      .then(response => response.json())
      .then(data => {
        const msgDiv = document.getElementById('mensagem');
        msgDiv.style.display = 'block';

        if (data.status === 'ok') {
          const li = document.createElement('li');
          li.textContent = '✅ ' + data.volume;
          document.getElementById('lista-volumes').appendChild(li);
          this.value = '';
          msgDiv.className = 'mensagem success';
          msgDiv.textContent = 'Volume adicionado com sucesso!';
          carregarPedidos(); // Atualiza a lista de pedidos
        } else if (data.status === 'warning') {
          msgDiv.className = 'mensagem warning';
          msgDiv.textContent = data.msg;
          this.value = ''; // Limpa o campo após aviso
        } else {
          msgDiv.className = 'mensagem error';
          msgDiv.textContent = data.msg || 'Erro ao registrar volume.';
          this.value = ''; // Limpa o campo em caso de erro
        }
      })
      .catch(err => {
        console.error(err);
        const msgDiv = document.getElementById('mensagem');
        msgDiv.style.display = 'block';
        msgDiv.className = 'mensagem error';
        msgDiv.textContent = 'Falha na conexão com o servidor.';
        this.value = '';
      });
    }
  });
};

      // Escanear volumes
      // document.getElementById('volume').addEventListener('keypress', function(e) {
      //   if (e.key === 'Enter') {
      //     e.preventDefault();
      //     const codigo = this.value.trim();
      //     if (!codigo) return;

      //     fetch('/registrar_volume', {
      //       method: 'POST',
      //       headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      //       body: new URLSearchParams({
      //         romaneio_id: '{{ romaneio_id }}',
      //         codigo_volume: codigo
      //       })
      //     })
      //     .then(response => response.json())
      //     .then(data => {
      //       const msgDiv = document.getElementById('mensagem');
      //       msgDiv.style.display = 'block';

      //       if (data.status === 'ok') {
      //         const li = document.createElement('li');
      //         li.textContent = '✅ ' + data.volume;
      //         document.getElementById('lista-volumes').appendChild(li);
      //         this.value = '';
      //         msgDiv.className = 'mensagem success';
      //         msgDiv.textContent = 'Volume adicionado com sucesso!';
      //         location.reload(); // Atualiza a tela para mostrar todos os volumes do pedido
      //       } else if (data.status === 'warning') {
      //         msgDiv.className = 'mensagem warning';
      //         msgDiv.textContent = data.msg;
      //       } else {
      //         msgDiv.className = 'mensagem error';
      //         msgDiv.textContent = data.msg || 'Erro ao registrar volume.';
      //       }
      //     })
      //     .catch(err => {
      //       console.error(err);
      //       const msgDiv = document.getElementById('mensagem');
      //       msgDiv.style.display = 'block';
      //       msgDiv.className = 'mensagem error';
      //       msgDiv.textContent = 'Falha na conexão com o servidor.';
      //     });
      //   }
      // });
      window.onload = () => {
  const romaneio_id = "{{ romaneio_id }}";
  carregarPedidos(); // 👈 Essa linha falta
  document.getElementById('volume').focus();

  // Restante do código...

  document.getElementById('volume').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    e.preventDefault(); // Evita comportamento padrão
    const codigo = this.value.trim();
    if (!codigo) return;

    fetch('/registrar_volume', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({
        romaneio_id: '{{ romaneio_id }}',
        codigo_volume: codigo
      })
    })
    .then(response => response.json())
    .then(data => {
      const msgDiv = document.getElementById('mensagem');
      msgDiv.style.display = 'block';

      if (data.status === 'ok') {
        const li = document.createElement('li');
        li.textContent = '✅ ' + data.volume;
        document.getElementById('lista-volumes').appendChild(li);
        this.value = '';
        msgDiv.className = 'mensagem success';
        msgDiv.textContent = data.msg || 'Volume adicionado com sucesso!';
      } else if (data.status === 'warning') {
        msgDiv.className = 'mensagem warning';
        msgDiv.textContent = data.msg;

        // ✅ Limpa o campo após aviso
        this.value = '';
      } else {
        msgDiv.className = 'mensagem error';
        msgDiv.textContent = data.msg || 'Erro ao registrar volume.';
        this.value = ''; // Também limpa o campo em caso de erro
      }

    })
    .catch(err => {
      console.error(err);
      const msgDiv = document.getElementById('mensagem');
      msgDiv.style.display = 'block';
      msgDiv.className = 'mensagem error';
      msgDiv.textContent = 'Falha na conexão com o servidor.';
      this.value = ''; // Limpa o campo em caso de falha
    });
  }
});
    };

    // Abrir modal com volumes do pedido
    function abrirModal(pedido_id) {
      fetch(`/get_volumes/${pedido_id}`)
        .then(response => response.json())
        .then(data => {
          if (data.status === 'ok') {
            const modal = document.getElementById('modal-pedido');
            const overlay = document.getElementById('modal-overlay');
            const titulo = document.getElementById('modal-titulo');
            const corpo = document.querySelector('#modal-corpo tbody');

            titulo.textContent = `Volumes do Pedido ${data.pedido.numero_pedido}`;
            corpo.innerHTML = '';

            data.volumes.forEach(volume => {
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td>${volume.codigo_barra}</td>
                <td>${volume.data_conferencia || '-'}</td>
                <td>${volume.status === 'escaneado' ? '✅ Conferido' : '❌ Pendente'}</td>
              `;
              corpo.appendChild(tr);
            });

            modal.style.display = 'block';
            overlay.style.display = 'block';
          }
        });
    }

    // Fechar modal
    function fecharModal() {
      document.getElementById('modal-pedido').style.display = 'none';
      document.getElementById('modal-overlay').style.display = 'none';
    }

    function initSwipeEvents(element, onDelete) {
    let startX = 0;
    let currentX = 0;
    let isDragging = false;

    element.addEventListener('touchstart', function(e) {
        startX = e.touches[0].clientX;
        isDragging = true;
    });

    element.addEventListener('touchmove', function(e) {
        if (!isDragging) return;
        currentX = e.touches[0].clientX;
        const deltaX = currentX - startX;

        if (deltaX < -50) {
            element.classList.add('swiped');
        } else if (deltaX > -10) {
            element.classList.remove('swiped');
        }
    });

    element.addEventListener('touchend', function() {
        isDragging = false;
        if (Math.abs(startX - currentX) > 50) {
            // Mantém o estado swiped até confirmar exclusão
        } else {
            element.classList.remove('swiped');
        }
    });

    element.querySelector('.swipe-delete-btn').addEventListener('click', onDelete);
}
function excluirPedido(id_pedido, liElement) {
    if (!confirm("Tem certeza que deseja excluir este pedido?")) return;

    fetch('/excluir_pedido', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams({
            pedido_id: id_pedido
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'ok') {
            liElement.remove(); // Remove da tela
        } else {
            alert("Erro ao excluir pedido.");
        }
    });
}
function carregarPedidos() {
    const romaneio_id = "{{ romaneio_id }}";
    const listaPedidos = document.getElementById('lista-pedidos');
    listaPedidos.innerHTML = ''; // Limpa antes de recarregar

    fetch(`/get_pedidos/${romaneio_id}`)
      .then(response => response.json())
      .then(data => {
        if (data.status === 'ok') {
          data.pedidos.forEach(pedido => {
            const container = document.createElement('div');
container.className = 'swipe-container';
container.innerHTML = `
  <div class="swipe-content">
    ${pedido.status === 'ok' ? '<span class="badge bg-success">✅</span>' : '<span class="badge bg-danger">❌</span>'}
    Pedido: ${pedido.numero_pedido} (${pedido.volumes_escaneados}/${pedido.total_volumes})
  </div>
  <button class="swipe-view-btn">Ver Volumes</button>
  <button class="swipe-delete-btn">Excluir</button>
`;
            listaPedidos.appendChild(container);

  const btnExcluir = container.querySelector('.swipe-delete-btn');               
  const btnVerVolumes = container.querySelector('.swipe-view-btn');
  btnVerVolumes.onclick = () => abrirModal(pedido.pedido_id);

initSwipeEvents(container, () => excluirPedido(pedido.pedido_id, container));
          });
        }
      });
}
  </script>

</body>
</html>